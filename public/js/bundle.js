(()=>{(()=>{"use strict";function I(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function se(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function le(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return le(e[0]);throw new Error("coordinates must only contain numbers")}function Je(e,t,n){if(!t||!n)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.type)}function Ke(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)}function Ue(e,t,n){if(!e)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of e.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+r.geometry.type)}}function Xe(e){return e.type==="Feature"?e.geometry:e}function We(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}var S=63710088e-1,J={centimeters:S*100,centimetres:S*100,degrees:360/(2*Math.PI),feet:S*3.28084,inches:S*39.37,kilometers:S/1e3,kilometres:S/1e3,meters:S,metres:S,miles:S/1609.344,millimeters:S*1e3,millimetres:S*1e3,nauticalmiles:S/1852,radians:1,yards:S*1.0936},K={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function k(e,t,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function Ve(e,t,n={}){switch(e){case"Point":return M(t).geometry;case"LineString":return F(t).geometry;case"Polygon":return U(t).geometry;case"MultiPoint":return ue(t).geometry;case"MultiLineString":return ce(t).geometry;case"MultiPolygon":return fe(t).geometry;default:throw new Error(e+" is invalid")}}function M(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!R(e[0])||!R(e[1]))throw new Error("coordinates must contain numbers");return k({type:"Point",coordinates:e},t,n)}function Qe(e,t,n={}){return T(e.map(r=>M(r,t)),n)}function U(e,t,n={}){for(const o of e){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return k({type:"Polygon",coordinates:e},t,n)}function Ye(e,t,n={}){return T(e.map(r=>U(r,t)),n)}function F(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return k({type:"LineString",coordinates:e},t,n)}function Ze(e,t,n={}){return T(e.map(r=>F(r,t)),n)}function T(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function ce(e,t,n={}){return k({type:"MultiLineString",coordinates:e},t,n)}function ue(e,t,n={}){return k({type:"MultiPoint",coordinates:e},t,n)}function fe(e,t,n={}){return k({type:"MultiPolygon",coordinates:e},t,n)}function je(e,t,n={}){return k({type:"GeometryCollection",geometries:e},t,n)}function et(e,t=0){if(t&&!(t>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,t||0);return Math.round(e*n)/n}function X(e,t="kilometers"){const n=J[t];if(!n)throw new Error(t+" units is invalid");return e*n}function q(e,t="kilometers"){const n=J[t];if(!n)throw new Error(t+" units is invalid");return e/n}function tt(e,t){return D(q(e,t))}function nt(e){let t=e%360;return t<0&&(t+=360),t}function rt(e){return e=e%360,e>0?e>180?e-360:e:e<-180?e+360:e}function D(e){return e%(2*Math.PI)*180/Math.PI}function L(e){return e%360*Math.PI/180}function ot(e,t="kilometers",n="kilometers"){if(!(e>=0))throw new Error("length must be a positive number");return X(q(e,t),n)}function it(e,t="meters",n="kilometers"){if(!(e>=0))throw new Error("area must be a positive number");const r=K[t];if(!r)throw new Error("invalid original units");const o=K[n];if(!o)throw new Error("invalid final units");return e/r*o}function R(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function at(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function st(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(t=>{if(!R(t))throw new Error("bbox must only contain numbers")})}function lt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function x(e,t,n={}){var r=I(e),o=I(t),i=L(o[1]-r[1]),l=L(o[0]-r[0]),s=L(r[1]),a=L(o[1]),c=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(s)*Math.cos(a);return X(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}var W=x;function A(e,t,n){if(e!==null)for(var r,o,i,l,s,a,c,u=0,f=0,p,h=e.type,d=h==="FeatureCollection",y=h==="Feature",P=d?e.features.length:1,m=0;m<P;m++){c=d?e.features[m].geometry:y?e.geometry:e,p=c?c.type==="GeometryCollection":!1,s=p?c.geometries.length:1;for(var w=0;w<s;w++){var b=0,E=0;if(l=p?c.geometries[w]:c,l!==null){a=l.coordinates;var v=l.type;switch(u=n&&(v==="Polygon"||v==="MultiPolygon")?1:0,v){case null:break;case"Point":if(t(a,f,m,b,E)===!1)return!1;f++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<a.length;r++){if(t(a[r],f,m,b,E)===!1)return!1;f++,v==="MultiPoint"&&b++}v==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<a.length;r++){for(o=0;o<a[r].length-u;o++){if(t(a[r][o],f,m,b,E)===!1)return!1;f++}v==="MultiLineString"&&b++,v==="Polygon"&&E++}v==="Polygon"&&b++;break;case"MultiPolygon":for(r=0;r<a.length;r++){for(E=0,o=0;o<a[r].length;o++){for(i=0;i<a[r][o].length-u;i++){if(t(a[r][o][i],f,m,b,E)===!1)return!1;f++}E++}b++}break;case"GeometryCollection":for(r=0;r<l.geometries.length;r++)if(A(l.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ct(e,t,n,r){var o=n;return A(e,function(i,l,s,a,c){l===0&&n===void 0?o=i:o=t(o,i,l,s,a,c)},r),o}function pe(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}function ut(e,t,n){var r=n;return pe(e,function(o,i){i===0&&n===void 0?r=o:r=t(r,o,i)}),r}function he(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function ft(e,t,n){var r=n;return he(e,function(o,i){i===0&&n===void 0?r=o:r=t(r,o,i)}),r}function pt(e){var t=[];return A(e,function(n){t.push(n)}),t}function V(e,t){var n,r,o,i,l,s,a,c,u,f,p=0,h=e.type==="FeatureCollection",d=e.type==="Feature",y=h?e.features.length:1;for(n=0;n<y;n++){for(s=h?e.features[n].geometry:d?e.geometry:e,c=h?e.features[n].properties:d?e.properties:{},u=h?e.features[n].bbox:d?e.bbox:void 0,f=h?e.features[n].id:d?e.id:void 0,a=s?s.type==="GeometryCollection":!1,l=a?s.geometries.length:1,o=0;o<l;o++){if(i=a?s.geometries[o]:s,i===null){if(t(null,p,c,u,f)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(i,p,c,u,f)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<i.geometries.length;r++)if(t(i.geometries[r],p,c,u,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function ht(e,t,n){var r=n;return V(e,function(o,i,l,s,a){i===0&&n===void 0?r=o:r=t(r,o,i,l,s,a)}),r}function O(e,t){V(e,function(n,r,o,i,l){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return t(k(n,o,{bbox:i,id:l}),r,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var c=0;c<n.coordinates.length;c++){var u=n.coordinates[c],f={type:a,coordinates:u};if(t(k(f,o),r,c)===!1)return!1}})}function dt(e,t,n){var r=n;return O(e,function(o,i,l){i===0&&l===0&&n===void 0?r=o:r=t(r,o,i,l)}),r}function de(e,t){O(e,function(n,r,o){var i=0;if(n.geometry){var l=n.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var s,a=0,c=0,u=0;if(A(n,function(f,p,h,d,y){if(s===void 0||r>a||d>c||y>u){s=f,a=r,c=d,u=y,i=0;return}var P=F([s,f],n.properties);if(t(P,r,o,y,i)===!1)return!1;i++,s=f})===!1)return!1}}})}function ge(e,t,n){var r=n,o=!1;return de(e,function(i,l,s,a,c){o===!1&&n===void 0?r=i:r=t(r,i,l,s,a,c),o=!0}),r}function me(e,t){if(!e)throw new Error("geojson is required");O(e,function(n,r,o){if(n.geometry!==null){var i=n.geometry.type,l=n.geometry.coordinates;switch(i){case"LineString":if(t(n,r,o,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<l.length;s++)if(t(lineString(l[s],n.properties),r,o,s)===!1)return!1;break}}})}function gt(e,t,n){var r=n;return me(e,function(o,i,l,s){i===0&&n===void 0?r=o:r=t(r,o,i,l,s)}),r}function mt(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,i=t.segmentIndex||0,l=t.properties,s;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),l=l||e.features[n].properties,s=e.features[n].geometry;break;case"Feature":l=l||e.properties,s=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=e;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return i<0&&(i=a.length+i-1),lineString([a[i],a[i+1]],l,t);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i-1),lineString([a[o][i],a[o][i+1]],l,t);case"MultiLineString":return r<0&&(r=a.length+r),i<0&&(i=a[r].length+i-1),lineString([a[r][i],a[r][i+1]],l,t);case"MultiPolygon":return r<0&&(r=a.length+r),o<0&&(o=a[r].length+o),i<0&&(i=a[r][o].length-i-1),lineString([a[r][o][i],a[r][o][i+1]],l,t)}throw new Error("geojson is invalid")}function yt(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,i=t.coordIndex||0,l=t.properties,s;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),l=l||e.features[n].properties,s=e.features[n].geometry;break;case"Feature":l=l||e.properties,s=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=e;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return point(a,l,t);case"MultiPoint":return r<0&&(r=a.length+r),point(a[r],l,t);case"LineString":return i<0&&(i=a.length+i),point(a[i],l,t);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i),point(a[o][i],l,t);case"MultiLineString":return r<0&&(r=a.length+r),i<0&&(i=a[r].length+i),point(a[r][i],l,t);case"MultiPolygon":return r<0&&(r=a.length+r),o<0&&(o=a[r].length+o),i<0&&(i=a[r][o].length-i),point(a[r][o][i],l,t)}throw new Error("geojson is invalid")}function ye(e,t={}){return ge(e,(n,r)=>{const o=r.geometry.coordinates;return n+x(o[0],o[1],t)},0)}var ve=ye;function Q(e,t,n={}){if(n.final===!0)return we(e,t);const r=I(e),o=I(t),i=L(r[0]),l=L(o[0]),s=L(r[1]),a=L(o[1]),c=Math.sin(l-i)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(l-i);return D(Math.atan2(c,u))}function we(e,t){let n=Q(t,e);return n=(n+180)%360,n}var vt=null;function Y(e,t,n,r={}){const o=I(e),i=L(o[0]),l=L(o[1]),s=L(n),a=q(t,r.units),c=Math.asin(Math.sin(l)*Math.cos(a)+Math.cos(l)*Math.sin(a)*Math.cos(s)),u=i+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(l),Math.cos(a)-Math.sin(l)*Math.sin(c)),f=D(u),p=D(c);return M([f,p],r.properties)}var wt=null;class Z{constructor(t=[],n=Ee){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:r}=this,o=n[t];for(;t>0;){const i=t-1>>1,l=n[i];if(r(o,l)>=0)break;n[t]=l,t=i}n[t]=o}_down(t){const{data:n,compare:r}=this,o=this.length>>1,i=n[t];for(;t<o;){let l=(t<<1)+1,s=n[l];const a=l+1;if(a<this.length&&r(n[a],s)<0&&(l=a,s=n[a]),r(s,i)>=0)break;n[t]=s,t=l}n[t]=i}}function Ee(e,t){return e<t?-1:e>t?1:0}function j(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function Pe(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class ee{constructor(t,n,r,o){this.p={x:t[0],y:t[1]},this.featureId=n,this.ringId=r,this.eventId=o,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(t){return this.p.x===t.p.x&&this.p.y===t.p.y}}function be(e,t){if(e.type==="FeatureCollection"){const n=e.features;for(let r=0;r<n.length;r++)te(n[r],t)}else te(e,t)}let G=0,$=0,B=0;function te(e,t){const n=e.type==="Feature"?e.geometry:e;let r=n.coordinates;(n.type==="Polygon"||n.type==="MultiLineString")&&(r=[r]),n.type==="LineString"&&(r=[[r]]);for(let o=0;o<r.length;o++)for(let i=0;i<r[o].length;i++){let l=r[o][i][0],s=null;$=$+1;for(let a=0;a<r[o][i].length-1;a++){s=r[o][i][a+1];const c=new ee(l,G,$,B),u=new ee(s,G,$,B+1);c.otherEvent=u,u.otherEvent=c,j(c,u)>0?(u.isLeftEndpoint=!0,c.isLeftEndpoint=!1):(c.isLeftEndpoint=!0,u.isLeftEndpoint=!1),t.push(c),t.push(u),l=s,B=B+1}}G=G+1}class Se{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}}function Me(e,t){if(e===null||t===null||e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const n=e.leftSweepEvent.p.x,r=e.leftSweepEvent.p.y,o=e.rightSweepEvent.p.x,i=e.rightSweepEvent.p.y,l=t.leftSweepEvent.p.x,s=t.leftSweepEvent.p.y,a=t.rightSweepEvent.p.x,c=t.rightSweepEvent.p.y,u=(c-s)*(o-n)-(a-l)*(i-r),f=(a-l)*(r-s)-(c-s)*(n-l),p=(o-n)*(r-s)-(i-r)*(n-l);if(u===0)return!1;const h=f/u,d=p/u;if(h>=0&&h<=1&&d>=0&&d<=1){const y=n+h*(o-n),P=r+h*(i-r);return[y,P]}return!1}function ke(e,t){t=t||!1;const n=[],r=new Z([],Pe);for(;e.length;){const o=e.pop();if(o.isLeftEndpoint){const i=new Se(o);for(let l=0;l<r.data.length;l++){const s=r.data[l];if(t&&s.leftSweepEvent.featureId===o.featureId)continue;const a=Me(i,s);a!==!1&&n.push(a)}r.push(i)}else o.isLeftEndpoint===!1&&r.pop()}return n}function Le(e,t){const n=new Z([],j);return be(e,n),ke(n,t)}var xe=Le;function _e(e,t,n={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:o=!1}=n;let i=[];e.type==="FeatureCollection"?i=i.concat(e.features):e.type==="Feature"?i.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&i.push(k(e)),t.type==="FeatureCollection"?i=i.concat(t.features):t.type==="Feature"?i.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&i.push(k(t));const l=xe(T(i),o);let s=[];if(r){const a={};l.forEach(c=>{const u=c.join(",");a[u]||(a[u]=!0,s.push(c))})}else s=l;return T(s.map(a=>M(a)))}var Pt=null,Ce=Object.defineProperty,Ie=Object.defineProperties,Fe=Object.getOwnPropertyDescriptors,ne=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable,re=(e,t,n)=>t in e?Ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_=(e,t)=>{for(var n in t||(t={}))Te.call(t,n)&&re(e,n,t[n]);if(ne)for(var n of ne(t))De.call(t,n)&&re(e,n,t[n]);return e},C=(e,t)=>Ie(e,Fe(t));function Ae(e,t,n={}){if(!e||!t)throw new Error("lines and pt are required arguments");let r=M([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),o=0;return O(e,function(i,l,s){const a=se(i);for(let c=0;c<a.length-1;c++){const u=M(a[c]);u.properties.dist=x(t,u,n);const f=M(a[c+1]);f.properties.dist=x(t,f,n);const p=x(u,f,n),h=Math.max(u.properties.dist,f.properties.dist),d=Q(u,f),y=Y(t,h,d+90,n),P=Y(t,h,d-90,n),m=_e(F([y.geometry.coordinates,P.geometry.coordinates]),F([u.geometry.coordinates,f.geometry.coordinates]));let w;m.features.length>0&&m.features[0]&&(w=C(_({},m.features[0]),{properties:{dist:x(t,m.features[0],n),multiFeatureIndex:s,location:o+x(u,m.features[0],n)}})),u.properties.dist<r.properties.dist&&(r=C(_({},u),{properties:C(_({},u.properties),{index:c,multiFeatureIndex:s,location:o})})),f.properties.dist<r.properties.dist&&(r=C(_({},f),{properties:C(_({},f.properties),{index:c+1,multiFeatureIndex:s,location:o+p})})),w&&w.properties.dist<r.properties.dist&&(r=C(_({},w),{properties:C(_({},w.properties),{index:c})})),o+=p}}),r}var oe=Ae;function Oe(e,t,n,r,o,i){e.off("click",t),e.on("click",t,function(l){const s=M([l.lngLat.lng,l.lngLat.lat]),c=oe(n.features[0],s,{units:"kilometers"}).properties.index,u=n.features[0].geometry.coordinates;let f=0,p=0;for(let m=0;m<=c;m++)if(m>0){const w=W(M(u[m-1]),M(u[m]),{units:"kilometers"});f+=w;const b=u[m][2]-u[m-1][2];b>0&&(p+=b)}const h=f,d=p,y=`
            <strong>${r.name}</strong><br>
            Distance to Point: ${convertDistance(h)}<br>
            Elevation Gain: ${convertElevation(d)}
        `,P=new mapboxgl.Popup().setLngLat(l.lngLat).setHTML(y).addTo(e);popupdata.push({popup:P,geojson:n,track:r,outAndBackDistance:h,outAndBackElevationGain:d}),P.on("close",function(){const m=popupdata.findIndex(w=>w.popup===P);m!==-1&&popupdata.splice(m,1)})})}function z(e,t,n,r,o){if(o.type==="loop"){const{distanceToPoint:i,elevationToPoint:l}=calculateDistanceAndElevation(t,n,r),s=convertDistance(i),a=convertElevation(l),c=`
            <strong>${o.name}</strong><br>
            Distance to Point: ${s}<br>
            Elevation Gain to Point: ${a}<br>
            <label>Direction: 
                <select id="directionToggle">
                    <option value="clockwise" ${r==="clockwise"?"selected":""}>Clockwise</option>
                    <option value="counterclockwise" ${r==="counterclockwise"?"selected":""}>Counterclockwise</option>
                </select>
            </label>
        `;e.setHTML(c);const u=document.getElementById("directionToggle");u&&u.addEventListener("change",function(){o.selectedDirection=this.value,z(e,t,n,o.selectedDirection,o)})}else if(o.type==="direct"){const i=t.features[0].geometry.coordinates;let l=0,s=0;for(let h=1;h<i.length;h++){const d=W(M(i[h-1]),M(i[h]),{units:"kilometers"});l+=d;const y=i[h][2]-i[h-1][2];y>0&&(s+=y)}const a=l*2,c=s*2,u=convertDistance(a),f=convertElevation(c),p=`
            <strong>${o.name}</strong><br>
            Distance to point: ${u}<br>
            Elevation Gain to point: ${f}
        `;e.setHTML(p)}}function Ge(e,t,n,r,o,i){e.off("click",t),e.on("click",t,function(l){if(e.queryRenderedFeatures(l.point,{layers:[t]}).length===0)return;const a=M([l.lngLat.lng,l.lngLat.lat]),c=oe(n.features[0],a,{units:"kilometers"}),u=c.properties.index,f=n.features[0].geometry.coordinates[u][2],p=new mapboxgl.Popup().setLngLat(l.lngLat).setHTML("").addTo(e);z(p,n,c,r.selectedDirection,r);const h={layerId:t,popup:p,geojson:n,nearestPoint:c,updateContent:function(){z(p,n,c,r.selectedDirection,r)}};popupdata.push(h),p.on("close",function(){const d=popupdata.findIndex(y=>y.popup===p);d!==-1&&popupdata.splice(d,1)})})}function $e(e,t){e.on("click",t,function(n){const r=n.features[0],o=r.geometry.coordinates.slice(),i=r.properties.name,l=r.properties.description||"No description available",s=r.properties.image||"";let a=`
            <strong>${i}</strong><br>
            ${l}
        `;s&&(a+=`<br><img src="${s}" alt="${i}" style="width: 100%; max-width: 200px; margin-top: 10px;">`);const c=new mapboxgl.Popup().setLngLat(o).setHTML(a).addTo(e)}),e.on("mouseenter",t,function(){e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",t,function(){e.getCanvas().style.cursor=""})}function bt(e){return isKilometers?e.toFixed(2)+" km":(e*.621371).toFixed(2)+" miles"}function St(e){return isKilometers?e.toFixed(2)+" m":(e*3.28084).toFixed(2)+" ft"}function Mt(e,t,n){const r=e.features[0].geometry.coordinates;if(!t||!t.properties||typeof t.properties.index=="undefined")return console.error("Invalid nearestPoint data:",t),{distanceToPoint:0,elevationToPoint:0};const o=t.properties.index;let i=0,l=0;if(n==="counterclockwise"){for(let s=0;s<=o;s++)if(s>0){const a=i(point(r[s-1]),point(r[s]),{units:"kilometers"});i+=a;const c=r[s][2]-r[s-1][2];c>0&&(l+=c)}}else for(let s=r.length-1;s>=o;s--)if(s<r.length-1){const a=i(point(r[s]),point(r[s+1]),{units:"kilometers"});i+=a;const c=r[s-1][2]-r[s][2];c>0&&(l+=c)}return{distanceToPoint:i,elevationToPoint:l}}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("unitSwitch"),t=document.getElementById("unitLabel"),n=document.getElementById("mapStyleSelect"),r=30*60*1e3,o=setInterval(()=>{window.mainMap&&(clearInterval(o),l())},100);e.addEventListener("change",function(){isKilometers=!e.checked;const c=e.checked?"miles":"km";i("unit",c),t.textContent=e.checked?"Miles":"Km",a()}),n.addEventListener("change",function(){const c=n.value;i("mapStyle",c),H(c)});function i(c,u){const f=new Date().getTime(),p={value:u,timestamp:f};localStorage.setItem(c,JSON.stringify(p))}function l(){const c=JSON.parse(localStorage.getItem("unit"));c&&s(c.timestamp)&&(e.checked=c.value==="miles",isKilometers=c.value!=="miles",t.textContent=e.checked?"Miles":"Km");const u=JSON.parse(localStorage.getItem("mapStyle"));u&&s(u.timestamp)?(n.value=u.value,H(u.value)):H("default")}function s(c){return new Date().getTime()-c<r}function a(){popupdata.forEach(c=>{if(c&&c.track&&c.geojson){const{popup:u,geojson:f,track:p,nearestPoint:h}=c,d=p.selectedDirection||"clockwise";u&&updatePopupContent(u,f,h,d,p)}else console.error("Invalid popupEntry found in popupdata:",c)})}});function N(e,t){const n=document.getElementById("toggles-bar");n.style.backgroundColor=e==="black"?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.8)",n.style.color=t,n.querySelectorAll("label, span, select").forEach(o=>{o.style.color=t})}function H(e){if(!mainMap){console.error("Map is not initialized");return}switch(e){case"light":mainMap.setStyle("mapbox://styles/mapbox/light-v10"),N("black","white");break;case"dark":mainMap.setStyle("mapbox://styles/mapbox/dark-v10"),N("white","black");break;case"satellite":mainMap.setStyle("mapbox://styles/mapbox/satellite-v9"),N("white","black");break;default:mainMap.setStyle("mapbox://styles/mapbox/outdoors-v12"),N("black","white")}mainMap.once("style.load",function(){Be()})}function Be(){loadPOIIcons(),fetch("Tracks/tracks.json").then(e=>e.json()).then(e=>Promise.all(e.mainMap((t,n)=>loadPOIs(t.url).then(r=>(t.pois=r,{track:t,index:n}))))).then(e=>{e.forEach(({track:t,index:n})=>{loadGPXTracksWithPOIs([t],n)})}).catch(e=>console.error("Error loading tracks file:",e))}var ie=(e,t,n)=>new Promise((r,o)=>{var i=a=>{try{s(n.next(a))}catch(c){o(c)}},l=a=>{try{s(n.throw(a))}catch(c){o(c)}},s=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,l);s((n=n.apply(e,t)).next())});let kt=!0,Lt=!0,Ne=[],g;function xt(){fetch("/google-tag").then(e=>{if(!e.ok)throw new Error("Failed to fetch Google Tag snippet");return e.text()}).then(e=>{const t=document.createElement("div");t.innerHTML=e,document.head.appendChild(t.querySelector("script"))}).catch(e=>console.error("Error loading Google Tag:",e))}fetch("/mapbox-token").then(e=>e.json()).then(e=>{mapboxgl.accessToken=e.accessToken,g=new mapboxgl.Map({container:"map",center:[-105.6129,39.99366],zoom:10,style:"mapbox://styles/mapbox/outdoors-v12"}),g.on("load",()=>ie(void 0,null,function*(){try{yield qe(),ze()}catch(t){console.error("Error during map initialization:",t)}}))}).catch(e=>{console.error("Error fetching Mapbox access token:",e)});function qe(){return ie(this,null,function*(){const e=[{url:"./Images/wilderness.png",name:"boundary"},{url:"./Images/pass.png",name:"pass"},{url:"./Images/pass.png",name:"summit"},{url:"./Images/flag.png",name:"flag"},{url:"./Images/junction.png",name:"junction"}];for(const t of e)yield new Promise((n,r)=>{g.loadImage(t.url,(o,i)=>{o?(console.error(`Error loading image: ${t.url}`,o),r(o)):(g.addImage(t.name,i),n())})})})}function Re(e,t){e.forEach(n=>{fetch(n.url).then(r=>r.text()).then(r=>{var o,i;const s=new DOMParser().parseFromString(r,"application/xml"),a=toGeoJSON.gpx(s),c=((i=(o=a.features[0])==null?void 0:o.properties)==null?void 0:i.name)||`Unnamed Track ${t+1}`;n.name=c;const u=a.features.filter(E=>E.geometry.type!=="Point"),f=`gpxTrack${t}`,p=`gpxTrackLine${t}`,h=`gpxTrackPOIsSource${t}`,d=`gpxTrackPOIs${t}`,y=`gpxTrackName${t}`;g.getSource(f)&&(g.removeLayer(p),g.removeSource(f)),g.getSource(h)&&(g.removeLayer(d),g.removeSource(h)),g.addSource(f,{type:"geojson",data:{type:"FeatureCollection",features:u}}),g.addLayer({id:p,type:"line",source:f,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#c3002f","line-width":3}});let P=ve(a,{units:"kilometers"}),m=0;const w=u[0].geometry.coordinates;for(let E=1;E<w.length;E++){const v=w[E-1][2],ae=w[E][2];ae>v&&(m+=ae-v)}if(n.pois&&n.pois.length>0){const E=n.pois.map(v=>({type:"Feature",geometry:{type:"Point",coordinates:[v.lng,v.lat]},properties:{name:v.name,icon:v.icon,description:v.description,image:v.image}}));g.addSource(h,{type:"geojson",data:{type:"FeatureCollection",features:E}}),g.addLayer({id:d,type:"symbol",source:h,layout:{"icon-image":["get","icon"],"icon-size":.15,"icon-allow-overlap":!0,"text-field":["get","name"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-offset":[0,1],"text-anchor":"top"},paint:{"text-color":"#666666","text-halo-color":"white","text-halo-width":1}})}$e(g,d),n.type==="loop"?Ge(g,p,a,n,P,m):Oe(g,p,a,n,P,m);const b={layerId:p,geojson:a,track:n,distance:P,totalElevationGain:m,popup:null,updateContent:function(){this.popup&&updatePopupContent(this.popup,this.geojson,this.track,this.track.selectedDirection)}};Ne.push(b),g.on("mouseenter",p,function(){g.getCanvas().style.cursor="pointer"}),g.on("mouseenter",d,function(){g.getCanvas().style.cursor="pointer"}),g.on("mouseenter",y,function(){g.getCanvas().style.cursor="pointer"}),g.on("mouseleave",p,function(){g.getCanvas().style.cursor=""}),g.on("mouseleave",d,function(){g.getCanvas().style.cursor=""}),g.on("mouseleave",y,function(){g.getCanvas().style.cursor=""})}).catch(r=>console.log("Error loading GPX track: ",r))})}function ze(){if(!g){console.error("Map is not initialized");return}fetch("Tracks/tracks.json").then(e=>{if(!e.ok)throw new Error(`Failed to fetch tracks.json: ${e.statusText}`);return e.json()}).then(e=>Promise.all(e.map((t,n)=>He(t.url).then(r=>(t.pois=r,{track:t,index:n}))))).then(e=>{e.forEach(({track:t,index:n})=>{Re([t],n)})}).catch(e=>console.error("Error loading tracks file:",e))}function He(e){const n=`Tracks/${e.split("/").slice(-1)[0].replace(".gpx","")}/poi.txt`;return fetch(n).then(r=>r.text()).then(r=>{try{return JSON.parse(r)}catch(o){return console.error("Error parsing POI data:",o),[]}}).catch(r=>(console.error("Error loading POI file:",r),[]))}})();})();

//# sourceMappingURL=bundle.js.map