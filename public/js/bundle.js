(()=>{(()=>{"use strict";var F={};F.d=(e,t)=>{for(var n in t)F.o(t,n)&&!F.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},F.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ge={};F.d(ge,{ow:()=>D,dN:()=>Q,iM:()=>Y,Es:()=>f,nF:()=>I});function T(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function de(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function me(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return me(e[0]);throw new Error("coordinates must only contain numbers")}function Ze(e,t,n){if(!t||!n)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.type)}function je(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)}function et(e,t,n){if(!e)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of e.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+r.geometry.type)}}function tt(e){return e.type==="Feature"?e.geometry:e}function nt(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}var M=63710088e-1,Z={centimeters:M*100,centimetres:M*100,degrees:360/(2*Math.PI),feet:M*3.28084,inches:M*39.37,kilometers:M/1e3,kilometres:M/1e3,meters:M,metres:M,miles:M/1609.344,millimeters:M*1e3,millimetres:M*1e3,nauticalmiles:M/1852,radians:1,yards:M*1.0936},j={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function k(e,t,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function rt(e,t,n={}){switch(e){case"Point":return b(t).geometry;case"LineString":return O(t).geometry;case"Polygon":return ee(t).geometry;case"MultiPoint":return ve(t).geometry;case"MultiLineString":return ye(t).geometry;case"MultiPolygon":return we(t).geometry;default:throw new Error(e+" is invalid")}}function b(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!K(e[0])||!K(e[1]))throw new Error("coordinates must contain numbers");return k({type:"Point",coordinates:e},t,n)}function ot(e,t,n={}){return A(e.map(r=>b(r,t)),n)}function ee(e,t,n={}){for(const o of e){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return k({type:"Polygon",coordinates:e},t,n)}function it(e,t,n={}){return A(e.map(r=>ee(r,t)),n)}function O(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return k({type:"LineString",coordinates:e},t,n)}function at(e,t,n={}){return A(e.map(r=>O(r,t)),n)}function A(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function ye(e,t,n={}){return k({type:"MultiLineString",coordinates:e},t,n)}function ve(e,t,n={}){return k({type:"MultiPoint",coordinates:e},t,n)}function we(e,t,n={}){return k({type:"MultiPolygon",coordinates:e},t,n)}function st(e,t,n={}){return k({type:"GeometryCollection",geometries:e},t,n)}function ct(e,t=0){if(t&&!(t>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,t||0);return Math.round(e*n)/n}function te(e,t="kilometers"){const n=Z[t];if(!n)throw new Error(t+" units is invalid");return e*n}function U(e,t="kilometers"){const n=Z[t];if(!n)throw new Error(t+" units is invalid");return e/n}function lt(e,t){return G(U(e,t))}function ut(e){let t=e%360;return t<0&&(t+=360),t}function ft(e){return e=e%360,e>0?e>180?e-360:e:e<-180?e+360:e}function G(e){return e%(2*Math.PI)*180/Math.PI}function L(e){return e%360*Math.PI/180}function pt(e,t="kilometers",n="kilometers"){if(!(e>=0))throw new Error("length must be a positive number");return te(U(e,t),n)}function ht(e,t="meters",n="kilometers"){if(!(e>=0))throw new Error("area must be a positive number");const r=j[t];if(!r)throw new Error("invalid original units");const o=j[n];if(!o)throw new Error("invalid final units");return e/r*o}function K(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function gt(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function dt(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(t=>{if(!K(t))throw new Error("bbox must only contain numbers")})}function mt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function x(e,t,n={}){var r=T(e),o=T(t),i=L(o[1]-r[1]),c=L(o[0]-r[0]),s=L(r[1]),a=L(o[1]),l=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(s)*Math.cos(a);return te(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}var N=x;function $(e,t,n){if(e!==null)for(var r,o,i,c,s,a,l,u=0,p=0,g,h=e.type,d=h==="FeatureCollection",y=h==="Feature",S=d?e.features.length:1,v=0;v<S;v++){l=d?e.features[v].geometry:y?e.geometry:e,g=l?l.type==="GeometryCollection":!1,s=g?l.geometries.length:1;for(var m=0;m<s;m++){var P=0,w=0;if(c=g?l.geometries[m]:l,c!==null){a=c.coordinates;var E=c.type;switch(u=n&&(E==="Polygon"||E==="MultiPolygon")?1:0,E){case null:break;case"Point":if(t(a,p,v,P,w)===!1)return!1;p++,P++;break;case"LineString":case"MultiPoint":for(r=0;r<a.length;r++){if(t(a[r],p,v,P,w)===!1)return!1;p++,E==="MultiPoint"&&P++}E==="LineString"&&P++;break;case"Polygon":case"MultiLineString":for(r=0;r<a.length;r++){for(o=0;o<a[r].length-u;o++){if(t(a[r][o],p,v,P,w)===!1)return!1;p++}E==="MultiLineString"&&P++,E==="Polygon"&&w++}E==="Polygon"&&P++;break;case"MultiPolygon":for(r=0;r<a.length;r++){for(w=0,o=0;o<a[r].length;o++){for(i=0;i<a[r][o].length-u;i++){if(t(a[r][o][i],p,v,P,w)===!1)return!1;p++}w++}P++}break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if($(c.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function yt(e,t,n,r){var o=n;return $(e,function(i,c,s,a,l){c===0&&n===void 0?o=i:o=t(o,i,c,s,a,l)},r),o}function Ee(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}function vt(e,t,n){var r=n;return Ee(e,function(o,i){i===0&&n===void 0?r=o:r=t(r,o,i)}),r}function be(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function wt(e,t,n){var r=n;return be(e,function(o,i){i===0&&n===void 0?r=o:r=t(r,o,i)}),r}function Et(e){var t=[];return $(e,function(n){t.push(n)}),t}function ne(e,t){var n,r,o,i,c,s,a,l,u,p,g=0,h=e.type==="FeatureCollection",d=e.type==="Feature",y=h?e.features.length:1;for(n=0;n<y;n++){for(s=h?e.features[n].geometry:d?e.geometry:e,l=h?e.features[n].properties:d?e.properties:{},u=h?e.features[n].bbox:d?e.bbox:void 0,p=h?e.features[n].id:d?e.id:void 0,a=s?s.type==="GeometryCollection":!1,c=a?s.geometries.length:1,o=0;o<c;o++){if(i=a?s.geometries[o]:s,i===null){if(t(null,g,l,u,p)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(i,g,l,u,p)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<i.geometries.length;r++)if(t(i.geometries[r],g,l,u,p)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}g++}}function bt(e,t,n){var r=n;return ne(e,function(o,i,c,s,a){i===0&&n===void 0?r=o:r=t(r,o,i,c,s,a)}),r}function B(e,t){ne(e,function(n,r,o,i,c){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return t(k(n,o,{bbox:i,id:c}),r,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var l=0;l<n.coordinates.length;l++){var u=n.coordinates[l],p={type:a,coordinates:u};if(t(k(p,o),r,l)===!1)return!1}})}function Pt(e,t,n){var r=n;return B(e,function(o,i,c){i===0&&c===0&&n===void 0?r=o:r=t(r,o,i,c)}),r}function Pe(e,t){B(e,function(n,r,o){var i=0;if(n.geometry){var c=n.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var s,a=0,l=0,u=0;if($(n,function(p,g,h,d,y){if(s===void 0||r>a||d>l||y>u){s=p,a=r,l=d,u=y,i=0;return}var S=O([s,p],n.properties);if(t(S,r,o,y,i)===!1)return!1;i++,s=p})===!1)return!1}}})}function Se(e,t,n){var r=n,o=!1;return Pe(e,function(i,c,s,a,l){o===!1&&n===void 0?r=i:r=t(r,i,c,s,a,l),o=!0}),r}function Me(e,t){if(!e)throw new Error("geojson is required");B(e,function(n,r,o){if(n.geometry!==null){var i=n.geometry.type,c=n.geometry.coordinates;switch(i){case"LineString":if(t(n,r,o,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<c.length;s++)if(t(lineString(c[s],n.properties),r,o,s)===!1)return!1;break}}})}function St(e,t,n){var r=n;return Me(e,function(o,i,c,s){i===0&&n===void 0?r=o:r=t(r,o,i,c,s)}),r}function Mt(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,i=t.segmentIndex||0,c=t.properties,s;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),c=c||e.features[n].properties,s=e.features[n].geometry;break;case"Feature":c=c||e.properties,s=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=e;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return i<0&&(i=a.length+i-1),lineString([a[i],a[i+1]],c,t);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i-1),lineString([a[o][i],a[o][i+1]],c,t);case"MultiLineString":return r<0&&(r=a.length+r),i<0&&(i=a[r].length+i-1),lineString([a[r][i],a[r][i+1]],c,t);case"MultiPolygon":return r<0&&(r=a.length+r),o<0&&(o=a[r].length+o),i<0&&(i=a[r][o].length-i-1),lineString([a[r][o][i],a[r][o][i+1]],c,t)}throw new Error("geojson is invalid")}function kt(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,i=t.coordIndex||0,c=t.properties,s;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),c=c||e.features[n].properties,s=e.features[n].geometry;break;case"Feature":c=c||e.properties,s=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=e;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return point(a,c,t);case"MultiPoint":return r<0&&(r=a.length+r),point(a[r],c,t);case"LineString":return i<0&&(i=a.length+i),point(a[i],c,t);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i),point(a[o][i],c,t);case"MultiLineString":return r<0&&(r=a.length+r),i<0&&(i=a[r].length+i),point(a[r][i],c,t);case"MultiPolygon":return r<0&&(r=a.length+r),o<0&&(o=a[r].length+o),i<0&&(i=a[r][o].length-i),point(a[r][o][i],c,t)}throw new Error("geojson is invalid")}function ke(e,t={}){return Se(e,(n,r)=>{const o=r.geometry.coordinates;return n+x(o[0],o[1],t)},0)}var Le=ke;function re(e,t,n={}){if(n.final===!0)return Ie(e,t);const r=T(e),o=T(t),i=L(r[0]),c=L(o[0]),s=L(r[1]),a=L(o[1]),l=Math.sin(c-i)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(c-i);return G(Math.atan2(l,u))}function Ie(e,t){let n=re(t,e);return n=(n+180)%360,n}var Lt=null;function oe(e,t,n,r={}){const o=T(e),i=L(o[0]),c=L(o[1]),s=L(n),a=U(t,r.units),l=Math.asin(Math.sin(c)*Math.cos(a)+Math.cos(c)*Math.sin(a)*Math.cos(s)),u=i+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(c),Math.cos(a)-Math.sin(c)*Math.sin(l)),p=G(u),g=G(l);return b([p,g],r.properties)}var It=null;class ie{constructor(t=[],n=xe){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:r}=this,o=n[t];for(;t>0;){const i=t-1>>1,c=n[i];if(r(o,c)>=0)break;n[t]=c,t=i}n[t]=o}_down(t){const{data:n,compare:r}=this,o=this.length>>1,i=n[t];for(;t<o;){let c=(t<<1)+1,s=n[c];const a=c+1;if(a<this.length&&r(n[a],s)<0&&(c=a,s=n[a]),r(s,i)>=0)break;n[t]=s,t=c}n[t]=i}}function xe(e,t){return e<t?-1:e>t?1:0}function ae(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function _e(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class se{constructor(t,n,r,o){this.p={x:t[0],y:t[1]},this.featureId=n,this.ringId=r,this.eventId=o,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(t){return this.p.x===t.p.x&&this.p.y===t.p.y}}function Ce(e,t){if(e.type==="FeatureCollection"){const n=e.features;for(let r=0;r<n.length;r++)ce(n[r],t)}else ce(e,t)}let q=0,R=0,z=0;function ce(e,t){const n=e.type==="Feature"?e.geometry:e;let r=n.coordinates;(n.type==="Polygon"||n.type==="MultiLineString")&&(r=[r]),n.type==="LineString"&&(r=[[r]]);for(let o=0;o<r.length;o++)for(let i=0;i<r[o].length;i++){let c=r[o][i][0],s=null;R=R+1;for(let a=0;a<r[o][i].length-1;a++){s=r[o][i][a+1];const l=new se(c,q,R,z),u=new se(s,q,R,z+1);l.otherEvent=u,u.otherEvent=l,ae(l,u)>0?(u.isLeftEndpoint=!0,l.isLeftEndpoint=!1):(l.isLeftEndpoint=!0,u.isLeftEndpoint=!1),t.push(l),t.push(u),c=s,z=z+1}}q=q+1}class Fe{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}}function Te(e,t){if(e===null||t===null||e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const n=e.leftSweepEvent.p.x,r=e.leftSweepEvent.p.y,o=e.rightSweepEvent.p.x,i=e.rightSweepEvent.p.y,c=t.leftSweepEvent.p.x,s=t.leftSweepEvent.p.y,a=t.rightSweepEvent.p.x,l=t.rightSweepEvent.p.y,u=(l-s)*(o-n)-(a-c)*(i-r),p=(a-c)*(r-s)-(l-s)*(n-c),g=(o-n)*(r-s)-(i-r)*(n-c);if(u===0)return!1;const h=p/u,d=g/u;if(h>=0&&h<=1&&d>=0&&d<=1){const y=n+h*(o-n),S=r+h*(i-r);return[y,S]}return!1}function Oe(e,t){t=t||!1;const n=[],r=new ie([],_e);for(;e.length;){const o=e.pop();if(o.isLeftEndpoint){const i=new Fe(o);for(let c=0;c<r.data.length;c++){const s=r.data[c];if(t&&s.leftSweepEvent.featureId===o.featureId)continue;const a=Te(i,s);a!==!1&&n.push(a)}r.push(i)}else o.isLeftEndpoint===!1&&r.pop()}return n}function Ae(e,t){const n=new ie([],ae);return Ce(e,n),Oe(n,t)}var De=Ae;function Ge(e,t,n={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:o=!1}=n;let i=[];e.type==="FeatureCollection"?i=i.concat(e.features):e.type==="Feature"?i.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&i.push(k(e)),t.type==="FeatureCollection"?i=i.concat(t.features):t.type==="Feature"?i.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&i.push(k(t));const c=De(A(i),o);let s=[];if(r){const a={};c.forEach(l=>{const u=l.join(",");a[u]||(a[u]=!0,s.push(l))})}else s=c;return A(s.map(a=>b(a)))}var _t=null,Ne=Object.defineProperty,$e=Object.defineProperties,Be=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,qe=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,ue=(e,t,n)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_=(e,t)=>{for(var n in t||(t={}))qe.call(t,n)&&ue(e,n,t[n]);if(le)for(var n of le(t))Re.call(t,n)&&ue(e,n,t[n]);return e},C=(e,t)=>$e(e,Be(t));function ze(e,t,n={}){if(!e||!t)throw new Error("lines and pt are required arguments");let r=b([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),o=0;return B(e,function(i,c,s){const a=de(i);for(let l=0;l<a.length-1;l++){const u=b(a[l]);u.properties.dist=x(t,u,n);const p=b(a[l+1]);p.properties.dist=x(t,p,n);const g=x(u,p,n),h=Math.max(u.properties.dist,p.properties.dist),d=re(u,p),y=oe(t,h,d+90,n),S=oe(t,h,d-90,n),v=Ge(O([y.geometry.coordinates,S.geometry.coordinates]),O([u.geometry.coordinates,p.geometry.coordinates]));let m;v.features.length>0&&v.features[0]&&(m=C(_({},v.features[0]),{properties:{dist:x(t,v.features[0],n),multiFeatureIndex:s,location:o+x(u,v.features[0],n)}})),u.properties.dist<r.properties.dist&&(r=C(_({},u),{properties:C(_({},u.properties),{index:l,multiFeatureIndex:s,location:o})})),p.properties.dist<r.properties.dist&&(r=C(_({},p),{properties:C(_({},p.properties),{index:l+1,multiFeatureIndex:s,location:o+g})})),m&&m.properties.dist<r.properties.dist&&(r=C(_({},m),{properties:C(_({},m.properties),{index:l})})),o+=g}}),r}var fe=ze;function He(){f.loadImage("./Images/wilderness.png",function(e,t){if(e)throw e;f.hasImage("boundary")||f.addImage("boundary",t)}),f.loadImage("./Images/pass.png",function(e,t){if(e)throw e;f.hasImage("pass")||f.addImage("pass",t)}),f.loadImage("./Images/pass.png",function(e,t){if(e)throw e;f.hasImage("summit")||f.addImage("summit",t)}),f.loadImage("./Images/flag.png",function(e,t){if(e)throw e;f.hasImage("flag")||f.addImage("flag",t)}),f.loadImage("./Images/junction.png",function(e,t){if(e)throw e;f.hasImage("junction")||f.addImage("junction",t)})}function X(e){return D?e.toFixed(2)+" km":(e*.621371).toFixed(2)+" miles"}function V(e){return D?e.toFixed(2)+" m":(e*3.28084).toFixed(2)+" ft"}function Je(e,t,n){const r=e.features[0].geometry.coordinates;if(!t||!t.properties||typeof t.properties.index=="undefined")return console.error("Invalid nearestPoint data:",t),{distanceToPoint:0,elevationToPoint:0};const o=t.properties.index;let i=0,c=0;if(n==="counterclockwise"){for(let s=0;s<=o;s++)if(s>0){const a=N(b(r[s-1]),b(r[s]),{units:"kilometers"});i+=a;const l=r[s][2]-r[s-1][2];l>0&&(c+=l)}}else for(let s=r.length-1;s>=o;s--)if(s<r.length-1){const a=N(b(r[s]),b(r[s+1]),{units:"kilometers"});i+=a;const l=r[s-1][2]-r[s][2];l>0&&(c+=l)}return{distanceToPoint:i,elevationToPoint:c}}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("unitSwitch"),t=document.getElementById("unitLabel"),n=document.getElementById("mapStyleSelect"),r=30*60*1e3,o=setInterval(()=>{window.mainMap&&(clearInterval(o),c())},100);e.addEventListener("change",function(){D=!e.checked;const l=e.checked?"miles":"km";i("unit",l),t.textContent=e.checked?"Miles":"Km",a()}),n.addEventListener("change",function(){const l=n.value;i("mapStyle",l),W(l)});function i(l,u){const p=new Date().getTime(),g={value:u,timestamp:p};localStorage.setItem(l,JSON.stringify(g))}function c(){const l=JSON.parse(localStorage.getItem("unit"));l&&s(l.timestamp)&&(e.checked=l.value==="miles",D=l.value!=="miles",t.textContent=e.checked?"Miles":"Km");const u=JSON.parse(localStorage.getItem("mapStyle"));u&&s(u.timestamp)?(n.value=u.value,W(u.value)):W("default")}function s(l){return new Date().getTime()-l<r}function a(){I.forEach(l=>{if(l&&l.track&&l.geojson){const{popup:u,geojson:p,track:g,nearestPoint:h}=l,d=g.selectedDirection||"clockwise";u&&J(u,p,h,d,g)}else console.error("Invalid popupEntry found in popupdata:",l)})}});function H(e,t){const n=document.getElementById("toggles-bar");n.style.backgroundColor=e==="black"?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.8)",n.style.color=t,n.querySelectorAll("label, span, select").forEach(o=>{o.style.color=t})}function W(e){if(!f){console.error("Map is not initialized");return}switch(e){case"light":f.setStyle("mapbox://styles/mapbox/light-v10"),H("black","white");break;case"dark":f.setStyle("mapbox://styles/mapbox/dark-v10"),H("white","black");break;case"satellite":f.setStyle("mapbox://styles/mapbox/satellite-v9"),H("white","black");break;default:f.setStyle("mapbox://styles/mapbox/outdoors-v12"),H("black","white")}f.once("style.load",function(){Ue()})}function Ue(){He(),fetch("Tracks/tracks.json").then(e=>e.json()).then(e=>Promise.all(e.map((t,n)=>Y(t.url).then(r=>(t.pois=r,{track:t,index:n}))))).then(e=>{e.forEach(({track:t,index:n})=>{Q([t],n)})}).catch(e=>console.error("Error loading tracks file:",e))}function Ke(e,t,n,r,o,i){e.off("click",t),e.off("touchstart",t);function c(s){const a=b([s.lngLat.lng,s.lngLat.lat]),u=fe(n.features[0],a,{units:"kilometers"}).properties.index,p=n.features[0].geometry.coordinates;let g=0,h=0;for(let m=0;m<=u;m++)if(m>0){const P=N(b(p[m-1]),b(p[m]),{units:"kilometers"});g+=P;const w=p[m][2]-p[m-1][2];w>0&&(h+=w)}const d=g,y=h,S=`
            <strong>${r.name}</strong><br>
            Distance to Point: ${X(d)}<br>
            Elevation Gain: ${V(y)}
        `,v=new mapboxgl.Popup().setLngLat(s.lngLat).setHTML(S).addTo(e);I.push({popup:v,geojson:n,track:r,outAndBackDistance:d,outAndBackElevationGain:y}),v.on("close",function(){const m=I.findIndex(P=>P.popup===v);m!==-1&&I.splice(m,1)})}e.on("click",t,c),e.on("touchstart",t,c)}function J(e,t,n,r,o){if(o.type==="loop"){const{distanceToPoint:i,elevationToPoint:c}=Je(t,n,r),s=X(i),a=V(c),l=`
            <strong>${o.name}</strong><br>
            Distance to Point: ${s}<br>
            Elevation Gain to Point: ${a}<br>
            <label>Direction: 
                <select id="directionToggle">
                    <option value="clockwise" ${r==="clockwise"?"selected":""}>Clockwise</option>
                    <option value="counterclockwise" ${r==="counterclockwise"?"selected":""}>Counterclockwise</option>
                </select>
            </label>
        `;e.setHTML(l);const u=document.getElementById("directionToggle");u&&u.addEventListener("change",function(){o.selectedDirection=this.value,J(e,t,n,o.selectedDirection,o)})}else if(o.type==="direct"){const i=t.features[0].geometry.coordinates;let c=0,s=0;for(let h=1;h<i.length;h++){const d=N(b(i[h-1]),b(i[h]),{units:"kilometers"});c+=d;const y=i[h][2]-i[h-1][2];y>0&&(s+=y)}const a=c,l=s,u=X(a),p=V(l),g=`
            <strong>${o.name}</strong><br>
            Distance to point: ${u}<br>
            Elevation Gain to point: ${p}
        `;e.setHTML(g)}}function Xe(e,t,n,r,o,i){e.off("click",t),e.off("touchstart",t);function c(s){if(e.queryRenderedFeatures(s.point,{layers:[t]}).length===0)return;const l=b([s.lngLat.lng,s.lngLat.lat]),u=fe(n.features[0],l,{units:"kilometers"}),p=u.properties.index,g=n.features[0].geometry.coordinates[p][2],h=new mapboxgl.Popup().setLngLat(s.lngLat).setHTML("").addTo(e);J(h,n,u,r.selectedDirection,r);const d={layerId:t,popup:h,geojson:n,nearestPoint:u,updateContent:function(){J(h,n,u,r.selectedDirection,r)}};I.push(d),h.on("close",function(){const y=I.findIndex(S=>S.popup===h);y!==-1&&I.splice(y,1)})}e.on("click",t,c),e.on("touchstart",t,c)}function Ve(e,t){e.on("click",t,function(n){const r=n.features[0],o=r.geometry.coordinates.slice(),i=r.properties.name,c=r.properties.description||"No description available",s=r.properties.image||"";let a=`
            <strong>${i}</strong><br>
            ${c}
        `;s&&(a+=`<br><img src="${s}" alt="${i}" id="poi-img">`);const l=new mapboxgl.Popup().setLngLat(o).setHTML(a).addTo(e)}),e.on("mouseenter",t,function(){e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",t,function(){e.getCanvas().style.cursor=""})}var pe=(e,t,n)=>new Promise((r,o)=>{var i=a=>{try{s(n.next(a))}catch(l){o(l)}},c=a=>{try{s(n.throw(a))}catch(l){o(l)}},s=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,c);s((n=n.apply(e,t)).next())});let D=!0,I=[],f=null;function Ct(){fetch("/google-tag").then(e=>{if(!e.ok)throw new Error("Failed to fetch Google Tag snippet");return e.text()}).then(e=>{const t=document.createElement("div");t.innerHTML=e,document.head.appendChild(t.querySelector("script"))}).catch(e=>console.error("Error loading Google Tag:",e))}fetch("/mapbox-token").then(e=>e.json()).then(e=>{mapboxgl.accessToken=e.accessToken,f=new mapboxgl.Map({container:"map",center:[-105.6129,39.99366],zoom:10,style:"mapbox://styles/mapbox/outdoors-v12"}),f.on("load",()=>pe(void 0,null,function*(){try{yield We(),Qe()}catch(t){console.error("Error during map initialization:",t)}}))}).catch(e=>{console.error("Error fetching Mapbox access token:",e)});function We(){return pe(this,null,function*(){const e=[{url:"./Images/wilderness.png",name:"boundary"},{url:"./Images/pass.png",name:"pass"},{url:"./Images/pass.png",name:"summit"},{url:"./Images/flag.png",name:"flag"},{url:"./Images/junction.png",name:"junction"}];for(const t of e)yield new Promise((n,r)=>{f.loadImage(t.url,(o,i)=>{o?(console.error(`Error loading image: ${t.url}`,o),r(o)):(f.addImage(t.name,i),n())})})})}function Q(e,t){e.forEach(n=>{fetch(n.url).then(r=>r.text()).then(r=>{var o,i;const s=new DOMParser().parseFromString(r,"application/xml"),a=toGeoJSON.gpx(s),l=((i=(o=a.features[0])==null?void 0:o.properties)==null?void 0:i.name)||`Unnamed Track ${t+1}`;n.name=l;const u=a.features.filter(w=>w.geometry.type!=="Point"),p=`gpxTrack${t}`,g=`gpxTrackLine${t}`,h=`gpxTrackPOIsSource${t}`,d=`gpxTrackPOIs${t}`,y=`gpxTrackName${t}`;f.getSource(p)&&(f.removeLayer(g),f.removeSource(p)),f.getSource(h)&&(f.removeLayer(d),f.removeSource(h)),f.addSource(p,{type:"geojson",data:{type:"FeatureCollection",features:u}}),f.addLayer({id:g,type:"line",source:p,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#c3002f","line-width":3}});let S=Le(a,{units:"kilometers"}),v=0;const m=u[0].geometry.coordinates;for(let w=1;w<m.length;w++){const E=m[w-1][2],he=m[w][2];he>E&&(v+=he-E)}if(n.pois&&n.pois.length>0){const w=n.pois.map(E=>({type:"Feature",geometry:{type:"Point",coordinates:[E.lng,E.lat]},properties:{name:E.name,icon:E.icon,description:E.description,image:E.image,weight:Ye(E.icon)}}));f.addSource(h,{type:"geojson",data:{type:"FeatureCollection",features:w}}),f.addLayer({id:d,type:"symbol",source:h,layout:{"icon-image":["get","icon"],"icon-size":.15,"icon-allow-overlap":!0,"text-field":["get","name"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-offset":[0,1],"text-anchor":"top","symbol-sort-key":["get","weight"]},paint:{"text-color":"#666666","text-halo-color":"white","text-halo-width":1}})}Ve(f,d),n.type==="loop"?Xe(f,g,a,n,S,v):Ke(f,g,a,n,S,v);const P={layerId:g,geojson:a,track:n,distance:S,totalElevationGain:v,popup:null,updateContent:function(){this.popup&&updatePopupContent(this.popup,this.geojson,this.track,this.track.selectedDirection)}};I.push(P),f.on("mouseenter",g,function(){f.getCanvas().style.cursor="pointer"}),f.on("mouseenter",d,function(){f.getCanvas().style.cursor="pointer"}),f.on("mouseenter",y,function(){f.getCanvas().style.cursor="pointer"}),f.on("mouseleave",g,function(){f.getCanvas().style.cursor=""}),f.on("mouseleave",d,function(){f.getCanvas().style.cursor=""}),f.on("mouseleave",y,function(){f.getCanvas().style.cursor=""})}).catch(r=>console.log("Error loading GPX track: ",r))})}function Qe(){if(!f){console.error("Map is not initialized");return}fetch("Tracks/tracks.json").then(e=>{if(!e.ok)throw new Error(`Failed to fetch tracks.json: ${e.statusText}`);return e.json()}).then(e=>Promise.all(e.map((t,n)=>Y(t.url).then(r=>(t.pois=r,{track:t,index:n}))))).then(e=>{e.forEach(({track:t,index:n})=>{Q([t],n)})}).catch(e=>console.error("Error loading tracks file:",e))}function Y(e){const n=`Tracks/${e.split("/").slice(-1)[0].replace(".gpx","")}/poi.txt`;return fetch(n).then(r=>r.text()).then(r=>{try{return JSON.parse(r)}catch(o){return console.error("Error parsing POI data:",o),[]}}).catch(r=>(console.error("Error loading POI file:",r),[]))}function Ye(e){return{flag:100,summit:100,boundary:50,pass:40,junction:10}[e]||0}})();})();
